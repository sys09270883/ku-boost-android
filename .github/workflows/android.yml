name: CI workflow

on:
  push:
    branches: [ main ]

jobs:
  apk:
    name: Generate APK
    runs-on: ubuntu-latest

    steps:
      - name: Clone repo
        uses: actions/checkout@v1

      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      
      - name: Decrypt Secrets
        # You may pin to the exact commit or the version.
        # uses: zgosalvez/github-actions-decrypt-secrets@ed88d64fadbe4e08e62d374cd9900fe001c5561b
        uses: zgosalvez/github-actions-decrypt-secrets@v1.1.3
        with:
          # The `gpg` file. For example, `.github/workflows/secrets.json.gpg`
          secrets_file: .github/workflows/services.tar.gpg
          # Describes the map between the environment variables and secret keys. For example, `SECRET_PASSWORD=PASSWORD,PASSPHRASE=passphrase`
          map: PASSPHRASE="sys09270883@gmail.com"

      - name: Build debug APK
        run: bash ./gradlew assembleDebug --stacktrace

      - name: Upload APK
        uses: actions/upload-artifact@v1
        with:
          name: app
          path: app/build/outputs/apk/debug/app-debug.apk
